### 一、转换目标

将腾讯文档等富文本编辑器的复制内容转换为简洁、结构化、AI友好的Markdown格式，同时：

- 保留核心语义和结构信息
- 移除冗余的样式和元数据
- 对无法转换的元素使用占位符
- 确保转换后内容可读性强

### 二、基于测试内容的转换策略

#### 2.1 标题处理

**输入特征:**

```html
<h1 class="paragraph text-align-type-left tco-title-title">测试</h1>
<h1 class="paragraph text-align-type-justify tco-title-heading 1">一级标题</h1>
<h2 class="paragraph text-align-type-justify tco-title-heading 2">二级标题</h2>
```

**转换规则:**

- `<h1>` → `# 标题内容`
- `<h2>` → `## 标题内容`
- `<h3>` → `### 标题内容`
- 最多支持6级标题
- **清理:** 删除所有class、style等属性

**转换结果示例:**

```markdown
# 测试

# 一级标题

## 二级标题

### 三级标题
```

#### 2.2 文本格式处理

**输入特征:**

```html
<span style="font-weight:bold">加粗正文</span>
<span style="font-style:italic">倾斜正文</span>
<span style="text-decoration:underline">下划线正文</span>
<span style="text-decoration:line-through">删除线正文</span>
```

**转换规则:**

- 加粗 (`font-weight:bold` 或 `<strong>`, `<b>`) → `**文本**`
- 斜体 (`font-style:italic` 或 `<em>`, `<i>`) → `*文本*`
- 删除线 (`text-decoration:line-through` 或 `<s>`, `<del>`) → `~~文本~~`
- 下划线 → 忽略(Markdown无原生支持)
- 上标/下标 → 保留为HTML: `<sup>上标</sup>`, `<sub>下标</sub>`

**转换结果示例:**

```markdown
**加粗正文**
_倾斜正文_
下划线正文
~~删除线正文~~
正文<sup>上标</sup>
正文<sub>下标</sub>
```

#### 2.3 列表处理

**输入特征:**

```html
<p class="MsoNormal" style="mso-list:l0 level1">
  <span style="font-family:Wingdings">●</span>无序列表1
</p>
<p class="MsoNormal" style="mso-list:l1 level1"><span>1.</span>有序列表1</p>
```

**转换规则:**

- 无序列表 → `- 列表项` 或 `* 列表项`
- 有序列表 → `1. 列表项`
- 复选框列表 → `- [ ] 列表项` (未选中) 或 `- [x] 列表项` (已选中)
- **嵌套识别:** 通过 `margin-left`、`text-indent` 或 `level` 属性识别层级

**转换结果示例:**

```markdown
- 无序列表1
- 无序列表2

1. 有序列表1
2. 有序列表2

- [ ] 复选框
```

#### 2.4 段落对齐处理

**输入特征:**

```html
<p style="text-align:left">左对齐</p>
<p style="text-align:center">居中对齐</p>
<p style="text-align:right">右对齐</p>
```

**转换规则:**

- **默认策略:** 忽略对齐属性，保留纯文本
- **理由:** Markdown无原生对齐支持，AI理解内容时对齐不重要

**转换结果示例:**

```markdown
左对齐
居中对齐
右对齐
```

#### 2.5 引用块处理

**输入特征:**

```html
<p style="border-left: #1E6FFF 1.5pt">引用</p>
```

**转换规则:**

- 检测 `<blockquote>` 标签或 `border-left` 样式
- 转换为 → `> 引用内容`

**转换结果示例:**

```markdown
> 引用
```

#### 2.6 高亮块处理

**输入特征:**

```html
<div data-bg-color="FEF8E4" data-border-color="FBEBAE">
  <p>高亮块</p>
</div>
```

**转换规则:**

- 转换为引用块 `> 高亮块`

**转换结果示例:**

```markdown
> 高亮块
```

#### 2.7 图片处理

**输入特征:**

```html
<img src="data:image/png;base64,..." alt="产品图" width="98" height="62" />
<img src="https://docimg10.docs.qq.com/image/..." alt="产品图" />
```

**转换规则:**

- **URL链接图片:** `![alt文本](图片URL)`
- **Base64/DataURL图片:** `[图片占位符: alt文本_序号]`
- **无alt属性:** `[图片占位符: 未命名图片_序号]`
- **SVG内联:** `[SVG图片占位符: 描述_序号]`

**转换结果示例:**

```markdown
图片：[图片占位符: 未命名图片_1]

---

**内容说明**:

- 本内容包含 1 个图片占位符
- 请优先基于现有文本内容进行理解和回答
- 如确需查看占位符对应的原始内容，请提示用户提供
```

#### 2.8 链接处理

**输入特征:**

```html
<a href="https://www.anylink.com">链接</a>
<a href="https://docs.qq.com/mind-addon">https://docs.qq.com/mind-addon</a>
```

**转换规则:**

- 标准链接 → `[链接文本](URL)`
- 纯URL链接 → 保留URL或 `<URL>`
- **清理:** 删除 `data-field-code` 等腾讯文档专有属性

**转换结果示例:**

```markdown
[链接](https://www.anylink.com)
https://docs.qq.com/mind-addon
```

#### 2.9 表格处理

**输入特征:**

```html
<!-- 普通表格 -->
<table>
  <tr>
    <td>普通表格</td>
    <td>普通表格</td>
  </tr>
  <tr>
    <td>普通表格</td>
    <td>普通表格</td>
  </tr>
</table>

<!-- 合并单元格表格 -->
<table>
  <tr>
    <td colspan="2">合并行列表格</td>
    <td rowspan="2">合并行列表格</td>
  </tr>
  <tr>
    <td>合并行列表格</td>
    <td>合并行列表格</td>
  </tr>
</table>
```

**转换规则:**

- **简单表格(无合并单元格):** 转换为Markdown表格
  ```markdown
  | 列1   | 列2   |
  | ----- | ----- |
  | 数据1 | 数据2 |
  ```
- **复杂表格(有合并单元格):** 保留精简HTML
  ```html
  <table>
    <tr>
      <td colspan="2">合并单元格</td>
    </tr>
  </table>
  ```
- **清理策略:**
  - 删除: `style`, `class`, `width`, `height`, `border-collapse` 等样式属性
  - 保留: `colspan`, `rowspan` 等结构属性

**转换结果示例:**

```markdown
| 普通表格 | 普通表格 |
| -------- | -------- |
| 普通表格 | 普通表格 |

<table>
<tr><td colspan="2">合并行列表格</td><td rowspan="2">合并行列表格</td></tr>
<tr><td>合并行列表格</td><td>合并行列表格</td></tr>
</table>
```

#### 2.10 代码块处理

**输入特征:**

```html
<pre><code data-tco-code-type="javascript">// 代码块</code></pre>
```

**转换规则:**

- 提取 `data-tco-code-type` 或 `class="language-xxx"` 识别语言
- 转换为Markdown代码块:
  ````markdown
  ```javascript
  // 代码块
  ```
  ````
- 如无语言标识，使用空语言标记 ` ```\n代码\n``` `

**转换结果示例:**

````markdown
```javascript
// 代码块
```
````

#### 2.11 分隔线处理

**输入特征:**

```html
<p class="horizontal-splitline" style="border-bottom: solid #030504 1pt"></p>
```

**转换规则:**

- 检测 `<hr>` 标签或 `border-bottom` 样式
- 转换为 → `---` 或 `***`

**转换结果示例:**

```markdown
---
```

#### 2.12 特殊元素处理

**输入特征:**

```html
<!-- 腾讯文档特有元素 -->
<div tdoc-data-src="...">
  <a data-field-code="HYPERLINK ... \tdw 9000 \tdh 6000 ..."></a>
</div>
```

**使用占位符，例如：**

- **腾讯文档元数据块:** `[腾讯文档元数据块：来源URL]`
- **iframe/embed:** `[iframe内容占位符: 来源URL]`

### 内容清理

- 删除script、style标签及内容
- 删除HTML注释
- 删除多余的空白行（连续超过2个空行压缩为2个）
- 删除HTML属性（除表格必需的rowspan/colspan）
