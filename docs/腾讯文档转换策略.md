### 一、清理策略

- 仅保留 `div.document > div.section` 节点
- 清除没有内容的空标签（只考虑内容，无论有无属性；内容只含换行符、空格、零宽字符、制表符等没事实际意义的内容时也视为空标签），内层标签清理后还需要再次判断上层标签是否为空(但是需要注意避开分割线和图片标签)

### 二、基于测试内容的转换策略

#### 2.1 标题处理

- `<h1>` → `# 标题内容`
- `<h2>` → `## 标题内容`
- `<h3>` → `### 标题内容`
- 最多支持6级标题
- 忽略标题内 style 含有 `mso-list: Ignore;` 的列表元素
- 忽略标题内的 `font-weight` 、 `font-style`

#### 2.2 文本格式处理

**输入特征:**

```html
<span style="font-weight:bold">加粗正文</span>
<span style="font-style:italic">倾斜正文</span>
<span style="text-decoration:underline">下划线正文</span>
<span style="text-decoration:line-through">删除线正文</span>
<span style="vertical-align: super">上标</span>
<span style="vertical-align: sub">下标</span>
```

**转换规则:**

- 加粗 (`font-weight:bold`) → `**文本**`
- 斜体 (`font-style:italic`) → `*文本*`
- 删除线 (`text-decoration:line-through`) → `~~文本~~`
- 上标/下标 → 保留为HTML: `<sup>上标</sup>`, `<sub>下标</sub>`

**转换结果示例:**

```markdown
**加粗正文**
_倾斜正文_
下划线正文
~~删除线正文~~
正文<sup>上标</sup>
正文<sub>下标</sub>
```

#### 2.3 列表处理

**输入特征:**

```html
<p style="mso-list: l0 level1"><span style="mso-list: Ignore">●</span>无序列表1</p>
<p style="mso-list: l0 level2"><span style="mso-list: Ignore">○</span>无序列表2</p>

<p style="mso-list: l1 level1"><span style="mso-list: Ignore">1.</span>有序列表1</p>
<p style="mso-list: l1 level2"><span style="mso-list: Ignore">a.</span>有序列表2</p>

<p style="mso-list: l2 level1"><span style="mso-list: Ignore"></span>一级复选框</p>
<p style="mso-list: l2 level2"><span style="mso-list: Ignore"></span>二级复选框</p>
```

**转换规则:**

- 以 style 中含有 `mso-list: l` 为判断标准
- 无论 l 几，均视为无序列表，level 作为缩进层级（从1开始）
- 含 `` （\uf0ae）字符的元素视为复选框
- 删除 style 含 `mso-list: Ignore` 的标识符
- 标题中无需处理

**转换结果示例:**

```markdown
- 无序列表1
  - 无序列表2

- 有序列表1
  - 有序列表2

- [ ] 一级复选框
  - [ ] 二级复选框
```

#### 2.5 引用块处理

**输入特征:**

```html
<p style="mso-border-left-alt: #1e6fff 1.5pt;">引用</p>
```

**转换规则:**

- 检测 mso-border-left-alt 属性，值可以与示例不一致
- 转换为 → `> 引用内容`

**转换结果示例:**

```markdown
> 引用
```

#### 2.6 高亮块处理

**输入特征:**

```html
<div data-bg-color="FEF8E4" data-border-color="FBEBAE">
  <p>高亮块</p>
</div>
```

**转换规则:**

- 转换为引用块 `> 高亮块`
- color 值可以与示例不一致

**转换结果示例:**

```markdown
> 高亮块
```

#### 2.7 表格处理

**输入特征:**

```html
<!-- 普通表格 -->
<table>
  <tr>
    <td>普通表格</td>
    <td>普通表格</td>
  </tr>
  <tr>
    <td>普通表格</td>
    <td>普通表格</td>
  </tr>
</table>

<!-- 合并单元格表格 -->
<table>
  <tr>
    <td colspan="2">合并行列表格</td>
    <td rowspan="2">合并行列表格</td>
  </tr>
  <tr>
    <td>合并行列表格</td>
    <td>合并行列表格</td>
  </tr>
</table>
```

**转换规则:**

- **简单表格(无合并单元格):** 转换为Markdown表格
  ```markdown
  | 列1   | 列2   |
  | ----- | ----- |
  | 数据1 | 数据2 |
  ```
- **复杂表格(有合并单元格):** 保留精简HTML
  ```html
  <table>
    <tr>
      <td colspan="2">合并单元格</td>
    </tr>
  </table>
  ```
- **清理策略:**
  - 删除: `style`, `class`, `width`, `height`, `border-collapse` 等样式属性
  - 保留: `colspan`, `rowspan` 等结构属性

**转换结果示例:**

```markdown
| 普通表格 | 普通表格 |
| -------- | -------- |
| 普通表格 | 普通表格 |

<table>
<tr><td colspan="2">合并行列表格</td><td rowspan="2">合并行列表格</td></tr>
<tr><td>合并行列表格</td><td>合并行列表格</td></tr>
</table>
```

#### 2.8 代码块处理

**输入特征:**

```html
<pre><code data-tco-code-type="javascript">// 代码块</code></pre>
```

**转换规则:**

- 提取 `data-tco-code-type` 识别语言
- 转换为Markdown代码块:
  ````markdown
  ```javascript
  // 代码块
  ```
  ````
- 如无语言标识，使用空语言标记 ` ```\n代码\n``` `

**转换结果示例:**

````markdown
```javascript
// 代码块
```
````

#### 2.9 图片处理

**输入特征:**

```html
<img src="data:image/png;base64,..." />
```

**转换规则:**

- **URL 链接图片:** `![图片序号](图片URL)`
- **Base64/DataURL/SVG 图片:** `[图片占位符: 序号]`

**转换结果示例:**

````markdown
![图片1](www.xxx.com)

## [图片占位符：2]

#### 2.10 链接处理

**输入特征:**

```html
<a href="https://www.anylink.com">链接</a>
<a href="https://docs.qq.com/mind-addon" data-field-code="HYPERLINK xxx" />
```
````

**转换规则:**

- 标准链接 → `[链接文本](URL)`
- 带 data-field-code="HYPERLINK 的链接 → `[腾讯文档内容块占位符：序号](URL)`

**转换结果示例:**

```markdown
[链接](https://www.anylink.com)
[腾讯文档内容块占位符：1](https://docs.qq.com/mind-addon)
```

#### 2.11 分隔线处理

**输入特征:**

```html
<p class="horizontal-splitline"></p>
```

**转换规则:**

- 转换为 → `---`

**转换结果示例:**

```markdown
---
```

#### 2.12 特殊元素处理

其他无法识别的元素，均使用占位符+序号，例如：

`[未知内容占位符：序号]`

**当转换后内容中含有：图片占位符、腾讯文档内容块占位符、未知元素占位符时，需要在转换后内容末尾添加提示词：**

```
---

**占位符说明：**

- 优先从现有内容中进行理解
- 如果确实需要补充占位符对应内容来补充理解，请提示用户提供 `xxx占位符：序号` 的内容
```
